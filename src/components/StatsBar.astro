---
import { getCollection } from 'astro:content';
import { getTagCounts, getCategoryCounts } from '../lib/utils';
import { fetchGitHubStats } from '../lib/github';

const posts = await getCollection('blog');
const tagCount = getTagCounts(posts).size;
const catCount = getCategoryCounts(posts).size;
const github = await fetchGitHubStats();
---

<footer
  class="fixed bottom-0 z-30 flex h-10 w-full items-center border-t border-border bg-bg/95 backdrop-blur-sm"
  transition:persist="stats-bar"
>
  <div
    class="mx-auto flex w-full max-w-wide items-center justify-between px-4 sm:px-6 lg:px-8 font-mono text-xs text-fg-dim"
  >
    <div class="flex items-center gap-2">
      <!-- Status indicator -->
      <span class="inline-block h-2 w-2 rounded-full bg-accent"></span>

      <div class="flex items-center gap-3">
        <span>
          <span class="font-semibold text-fg">{posts.length}</span>
          <span>posts</span>
        </span>

        <span class="text-border-hover">路</span>

        <span>
          <span class="font-semibold text-fg">{catCount}</span>
          <span>categories</span>
        </span>

        <span class="hidden text-border-hover sm:inline">路</span>

        <span class="hidden sm:inline">
          <span class="font-semibold text-fg">{tagCount}</span>
          <span>tags</span>
        </span>

        <span class="hidden text-border-hover md:inline">路</span>

        <span class="hidden md:inline">
          <span class="font-semibold text-fg">{github.followers}</span>
          <span>followers</span>
        </span>

        <span class="hidden text-border-hover md:inline">路</span>

        <span class="hidden md:inline">
          <span class="font-semibold text-fg">{github.publicRepos}</span>
          <span>repos</span>
        </span>
      </div>
    </div>

    <div class="flex items-center gap-3 text-xs">
      <span class="hidden lg:inline text-fg-dim">
        <span class="text-tag">:</span> cmd
        <span class="text-fg-dim mx-1">/</span>
        <span class="text-tag">/</span> search
      </span>
      <a
        href="https://github.com/sbulav"
        class="text-fg-dim hover:text-fg transition-colors"
        target="_blank"
        rel="noopener noreferrer"
      >
        @sbulav
      </a>
    </div>
  </div>
</footer>
