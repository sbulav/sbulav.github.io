---
interface Props {
  currentPage: number;
  totalPages: number;
  basePath?: string;
}

const { currentPage, totalPages, basePath = '/page' } = Astro.props;

function getPageUrl(page: number): string {
  if (page === 1) return '/';
  return `${basePath}/${page}/`;
}

// Pre-compute which page numbers/ellipses to show
type PageItem = { type: 'page'; page: number; isCurrent: boolean } | { type: 'ellipsis' };

const items: PageItem[] = [];
for (let page = 1; page <= totalPages; page++) {
  const isCurrent = page === currentPage;
  const show = page === 1 || page === totalPages || Math.abs(page - currentPage) <= 2;
  const showEllipsis = !show && (page === 2 || page === totalPages - 1);

  if (showEllipsis) {
    items.push({ type: 'ellipsis' });
  } else if (show) {
    items.push({ type: 'page', page, isCurrent });
  }
}
---

{totalPages > 1 && (
  <nav class="mt-10 flex items-center justify-center gap-2 font-mono text-sm" aria-label="Pagination">
    {currentPage > 1 && (
      <a
        href={getPageUrl(currentPage - 1)}
        class="rounded border border-border bg-bg-secondary px-4 py-2 text-fg-muted transition-colors hover:border-accent hover:text-fg"
      >
        &lt; prev
      </a>
    )}

    {items.map(item =>
      item.type === 'ellipsis' ? (
        <span class="px-2 text-fg-dim">...</span>
      ) : (
        <a
          href={getPageUrl(item.page)}
          class:list={[
            'rounded border px-3.5 py-2 transition-colors',
            item.isCurrent
              ? 'border-accent bg-accent/10 text-accent font-semibold'
              : 'border-border bg-bg-secondary text-fg-muted hover:border-accent hover:text-fg',
          ]}
          aria-current={item.isCurrent ? 'page' : undefined}
        >
          {item.page}
        </a>
      )
    )}

    {currentPage < totalPages && (
      <a
        href={getPageUrl(currentPage + 1)}
        class="rounded border border-border bg-bg-secondary px-4 py-2 text-fg-muted transition-colors hover:border-accent hover:text-fg"
      >
        next &gt;
      </a>
    )}
  </nav>
)}
