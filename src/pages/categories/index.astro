---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getUniqueCategories } from '../../utils/helpers';

const posts = await getCollection('blog', ({ data }) => !data.draft);
const categories = getUniqueCategories(posts);

const categoryCounts = categories.map((cat) => ({
  name: cat,
  count: posts.filter((p) => p.data.categories.includes(cat)).length,
}));
---

<BaseLayout title="Categories" description="Browse posts by category">
  <h1 class="text-2xl font-bold mb-6 flex items-center gap-2">
    <span class="text-accent">$</span> ls categories/
  </h1>
  
  <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
    {categoryCounts.map((cat) => (
      <a 
        href={`/categories/${cat.name}/`}
        class="post-card"
      >
        <span class="text-lg font-semibold">{cat.name}</span>
        <span class="text-fg/50 text-sm ml-2">({cat.count})</span>
      </a>
    ))}
  </div>
</BaseLayout>
