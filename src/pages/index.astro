---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { formatDate, getUniqueCategories, getUniqueTags } from '../utils/helpers';

const posts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const categories = getUniqueCategories(posts);
const tags = getUniqueTags(posts);
---

<BaseLayout title="Cloud Alchemist" description="Personal blog with emphasis on cloud-native technologies">
  <section class="mb-12">
    <div class="border border-border rounded-lg p-6 mb-8">
      <h1 class="text-3xl font-bold mb-4">~/sbulav <span class="text-accent">$</span> whoami</h1>
      <p class="text-fg/80 leading-relaxed">
        Senior DevOps Engineer with expertise in AWS, Kubernetes, Terraform, ArgoCD, and NixOS. 
        This blog contains my notes, tutorials, and thoughts on cloud-native technologies.
      </p>
    </div>
    
    <div class="flex flex-wrap gap-4 text-sm">
      <a href="/posts/" class="px-3 py-1 border border-border rounded hover:border-accent/50 transition-colors">
        <span class="text-accent">[{posts.length}]</span> Posts
      </a>
      <a href="/categories/" class="px-3 py-1 border border-border rounded hover:border-accent/50 transition-colors">
        <span class="text-accent">[{categories.length}]</span> Categories
      </a>
      <a href="/tags/" class="px-3 py-1 border border-border rounded hover:border-accent/50 transition-colors">
        <span class="text-accent">[{tags.length}]</span> Tags
      </a>
    </div>
  </section>
  
  <section>
    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
      <span class="text-accent">$</span> ls -lt recent_posts/
    </h2>
    
    <div class="space-y-4">
      {sortedPosts.slice(0, 10).map((post) => (
        <a 
          href={`/posts/${post.slug}/`}
          class="block post-card"
        >
          <div class="flex items-start justify-between gap-4">
            <h3 class="font-semibold text-lg hover:text-accent transition-colors">
              {post.data.title}
            </h3>
            <time class="text-sm text-fg/50 whitespace-nowrap">
              {formatDate(post.data.date)}
            </time>
          </div>
          
          {post.data.description && (
            <p class="text-fg/60 text-sm mt-2 line-clamp-2">
              {post.data.description}
            </p>
          )}
          
          <div class="flex flex-wrap gap-2 mt-3">
            {post.data.categories.map((cat) => (
              <span class="text-xs text-accent">#{cat}</span>
            ))}
          </div>
        </a>
      ))}
    </div>
    
    {posts.length > 10 && (
      <div class="mt-6 text-center">
        <a 
          href="/posts/" 
          class="inline-flex items-center gap-2 px-4 py-2 border border-border rounded hover:border-accent/50 transition-colors"
        >
          <span class="text-accent">â†’</span> View all {posts.length} posts
        </a>
      </div>
    )}
  </section>
</BaseLayout>
